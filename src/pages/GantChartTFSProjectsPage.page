<!--
 - Created by arnab.karsarkar on 11/15/2016.
 -->
<apex:page id="GantChartTFSProjectsPage" sideBar="false" controller="GanttChartTFSProjectController" standardStylesheets="false">


    <apex:includeScript value="{!URLFOR($Resource.inContactResource, '/inContactResource/js/jquery-3.1.1.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.KendoUIGanttChart, '/kendo-UI/js/kendo.all.min.js')}"/>



    <apex:stylesheet value="{!URLFOR($Resource.inContactResource, '/inContactResource/css/bootstrap.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.inContactResource, '/inContactResource/css/bootstrap-theme.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.KendoUIGanttChart, '/kendo-UI/styles/kendo.common.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.KendoUIGanttChart, '/kendo-UI/styles/kendo.rtl.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.KendoUIGanttChart, '/kendo-UI/styles/kendo.default.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.KendoUIGanttChart, '/kendo-UI/styles/kendo.silver.min.css')}"/>


    <script>


    var program = '';

    $(document).ready(function(){
        var ganttdataSource = new kendo.data.GanttDataSource({
          transport: {
            read: function(options){
                 GanttChartTFSProjectController.kendoData(
                     function(result,event){
                       options.success(JSON.parse(result));
                       console.log('options =>' + JSON.stringify(options));
                       console.log(JSON.stringify(result));
                     },
                     {escape: false}
                 );
            }
          },
          schema: {
            model: {
              id: "id",
              fields: {
                id: { from: "ProjectId", type: "string" },
                orderId: { from: "GlobalPriority", type: "number" },
                parentId: { from: "ParentId", type: "string",defaultValue: null },
                start: { from: "StartDate", type: "date" },
                end: { from: "EndDate", type: "date" },
                title: { from: "ProjectName", defaultValue: "", type: "string" },
                percentComplete: { from: "PercentComplete", type: "number" },
                summary: { from: "Summary", type: "boolean" },
                expanded: { from: "Expanded", type:"boolean", defaultValue: true  }
              }
            }
          }
        });

         var gantt = $("#chart_div").kendoGantt({
            tooltip: {
                visible: true,
                template: $("#tooltip-template").html()
              },
            dataSource:ganttdataSource,
            editable: false,
            showWorkHours: false,
            showWorkDays: false,
            snap: false,
            columns: [
                        { field: "title", title: "Title", editable: true, sortable: true },
                        { field: "start", title: "Start Time", format: "{0:MM/dd/yyyy}", width: 100},
                        { field: "end", title: "End Time", format: "{0:MM/dd/yyyy}", width: 100}
                    ],
            views: [  { type: "month", selected: true },

                    ],
            dataBound: onDataBound

         }).data("kendoGantt");

        $(document).bind("kendo:skinChange", function() {
                    gantt.refresh();
         });



    });

    function onDataBound() {
        var gantt = this;

        gantt.element.find(".k-task").each(function(e) {
          var dataItem = gantt.dataSource.getByUid($(this).attr("data-uid"));
            this.style.backgroundColor = dataItem.ProgramColor;
          // colorize task per business requirements
          console.log('dataItem.ProgramColor =>' + dataItem.ProgramColor);

        });
      }


    </script>

    <script id="tooltip-template" type="text/x-kendo-template">

            <div>
                <strong >Title  : #= task.title #</strong><br/>
                <strong>Start Date:  #= task.start #</strong><br/>
                <strong>End Date:  #= task.end #</strong><br/>
            </div>

    </script>


    <apex:form >
        <div style="padding-bottom:5px;">

            <apex:outputPanel id="programPanel">
                <apex:outputPanel layout="block">Select a Program to filter &nbsp;
                    <apex:selectList value="{!selectedPrograms}" size="1" onChange="onChangeProj(this);">
                        <apex:selectOptions value="{!programs}" />
                    </apex:selectList>
                    <center>

                        <apex:selectCheckboxes  value="{!selectedTeams}" onChange="onChangeTeam(this);" >
                            <apex:selectOptions value="{!TeamLists}" />
                        </apex:selectCheckboxes>
                    </center>
                </apex:outputPanel>

            </apex:outputPanel>
        </div>

        <div id="chart_div"></div>
    </apex:form>
</apex:page>